---
import { ChevronRight, Home } from "lucide-react";

interface Props {
  className?: string;
}

const { className = "" } = Astro.props;

const pathname = Astro.url.pathname;
const pathSegments = pathname.split("/").filter((segment) => segment !== "");

const breadcrumbs = pathSegments.map((segment, index) => {
  const href = "/" + pathSegments.slice(0, index + 1).join("/");
  const label = segment
    .split("-")
    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))
    .join(" ");
  return { label, href };
});

// JSON-LD for BreadcrumbList
const breadcrumbListJsonLd = {
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position": 1,
      "name": "Home",
      "item": Astro.site?.toString() || "https://coalbanks.ca"
    },
    ...breadcrumbs.map((crumb, index) => ({
      "@type": "ListItem",
      "position": index + 2,
      "name": crumb.label,
      "item": new URL(crumb.href, Astro.site).toString()
    }))
  ]
};
---

<nav aria-label="Breadcrumb" class={`flex items-center space-x-2 text-sm text-muted-foreground ${className}`}>
  <a href="/" class="flex items-center hover:text-primary transition-colors">
    <Home className="h-4 w-4" />
    <span class="sr-only">Home</span>
  </a>
  
  {breadcrumbs.length > 0 && (
    <ChevronRight className="h-4 w-4 shrink-0" />
  )}

  {breadcrumbs.map((crumb, index) => (
    <div class="flex items-center space-x-2">
      {index === breadcrumbs.length - 1 ? (
        <span class="font-medium text-foreground truncate max-w-[200px]" aria-current="page">
          {crumb.label}
        </span>
      ) : (
        <>
          <a href={crumb.href} class="hover:text-primary transition-colors">
            {crumb.label}
          </a>
          <ChevronRight className="h-4 w-4 shrink-0" />
        </>
      )}
    </div>
  ))}

  <script type="application/ld+json" set:html={JSON.stringify(breadcrumbListJsonLd)} />
</nav>
